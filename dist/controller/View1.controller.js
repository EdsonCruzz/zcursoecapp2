sap.ui.define(["zcursoecapp2/controller/App.controller","sap/ui/model/json/JSONModel","sap/m/library","sap/m/MessagePopover","sap/ui/table/Column","sap/ui/model/FilterOperator","sap/ui/model/Filter","sap/m/MessageItem"],function(e,t,i,o,s,a,r,n){"use strict";var l;return e.extend("zcursoecapp2.controller.View1",{onInit:function(){this.criaModeloAuxiliar()},onValueHelpUser:function(){if(!this.pDialog){this.pDialog=this.loadFragment({name:"zcursoecapp2.view.fragmentos.ValueHelpUser"})}this.pDialog.then(function(e){var t=e.getFilterBar();this._oVHD=e;if(this._bDialogInitialized){e.open();return}this.getView().addDependent(e);t.setFilterBarExpanded(true);e.getTableAsync().then(function(t){t.setModel(this.oProductsModel);if(t.bindRows){t.bindAggregation("rows",{path:"/ZshHelpAlunoEcSet",events:{dataReceived:function(){e.update()}}});t.addColumn(new s({label:"Usuario",template:"Usuario"}));t.addColumn(new s({label:"Nome",template:"Nome"}));t.addColumn(new s({label:"Email",template:"Email"}))}if(t.bindItems){t.bindAggregation("items",{path:"/ZshHelpAlunoEcSet",template:new ColumnListItem({cells:[new Label({text:"{Usuario}"}),new Label({text:"{Nome}"}),new Label({text:"{Email}"})]}),events:{dataReceived:function(){e.update()}}});t.addColumn(new MColumn({header:new Label({text:"Usuario"})}));t.addColumn(new MColumn({header:new Label({text:"Nome"})}));t.addColumn(new MColumn({header:new Label({text:"Email"})}))}e.update()}.bind(this));this._bDialogInitialized=true;e.open()}.bind(this))},onFilterBarSearchUserA:function(e){var t=e.getParameter("selectionSet");var i=t.reduce(function(e,t){if(t.getValue()){e.push(new r({path:t.getName(),operator:a.Contains,value1:t.getValue()}))}return e},[]);this._filterTableA(new r({filters:i,and:true}))},_filterTableA:function(e){var t=this._oVHD;t.getTableAsync().then(function(i){if(i.bindRows){i.getBinding("rows").filter(e)}if(i.bindItems){i.getBinding("items").filter(e)}t.update()})},onValueHelpOkPressA:function(e){var t=e.getParameter("tokens");var i=t[0].getProperty("key");this._user=this.byId("idUserHelp");this._user.setValue(i);this._oVHD.close()},onValueHelpCancelPressA:function(e){this._oVHD.close()},criaModeloAuxiliar:function(){let e=new t;let i={Menssagens:[],Editable:false};e.setData(i);this.getView().setModel(e,"Auxiliar");this.AlimentaModeloMenssagens()},AlimentaModeloMenssagens:function(){let e=new n({type:"{Auxiliar>type}",title:"{Auxiliar>title}",activeTitle:"{Auxiliar>active}",description:"{Auxiliar>description}",subtitle:"{Auxiliar>subtitle}",counter:"{Auxiliar>counter}"});l=new o({items:{path:"Auxiliar>/Menssagens",template:e},activeTitlePress:function(){}});var t=this.byId("messagePopoverBtn");if(t){this.byId("messagePopoverBtn").addDependent(l)}},acessaMaterialCurso:function(){let e=i.URLHelper;e.redirect("https://uh924mhkawsbhi-my.sharepoint.com/personal/exed_academy_exedconsulting_com/_layouts/15/onedrive.aspx?id=%2Fpersonal%2Fexed%5Facademy%5Fexedconsulting%5Fcom%2FDocuments%2F01%2E%20CURSOS%2FC035%20%2D%20SAP%20FIORI%20%28%40BRA%5FABERTO%29%2F03%2E%20Diret%C3%B3rio%20Alunos%20%2D%20Curso%20SAP%20FIORI%2F01%2E%20Materiais&ct=1713275873542&or=Teams%2DHL&ga=1",true)},acessaGitHub:function(){let e=i.URLHelper;e.redirect("https://github.com/EdsonCruzz/zcursoecapp2",true)},onDeleta:function(){let e=this;let t=this.getView().getModel();let i=this.getView().getModel("Auxiliar");let o=this.getView().byId("idTable");let s=o.getSelectedContextPaths();if(s.length>0){sap.m.MessageBox.alert("Confirma a exclusão de todos os alunos selecionados?",{actions:["Sim","Não"],onClose:function(o){if(o=="Sim"){let o;for(let a=0;a<s.length;a++){o=s[a];t.remove(o,{success:function(){let t={type:"Success",title:"Aluno excluido com sucesso",activeTitle:true,description:"O aluno com indice "+o+" foi excluido com sucesso!!!"};i.oData.Menssagens.push(t);i.refresh(true);e.byId("messagePopoverBtn").setType("Accept");l.openBy(e.getView().byId("messagePopoverBtn"))},error:function(){let t={type:"Error",title:"Erro ao excluir o aluno",activeTitle:true,description:"Erro ao excluir o aluno com indice "+o+" !!!"};i.oData.Menssagens.push(t);i.refresh(true);e.byId("messagePopoverBtn").setType("Accept");l.openBy(e.getView().byId("messagePopoverBtn"))}})}}}})}else{sap.m.MessageBox.error("Selecione ao menos um aluno para exclusão!!!")}},onAdciona:function(){if(!this.adicionar){this.adicionar=sap.ui.xmlfragment("zcursoecapp2.view.fragmentos.Adicionar",this);this.getView().addDependent(this.adicionar)}this.adicionar.open()},CancelarAdicionar:function(){this.adicionar.close()},GravaAdicionar:function(){let e=this;let t=this.getView().getModel();let i=this.getView().getModel("Auxiliar");let o=this.adicionar.mAggregations.content[0].getValue();let s=this.adicionar.mAggregations.content[1].getValue();let a=this.adicionar.mAggregations.content[2].getValue();let r=this.adicionar.mAggregations.content[3].getValue();var n={Usuario:o};this.getView().getModel().callFunction("/GetUserExist",{method:"GET",urlParameters:n,success:function(n,u){if(n.Ok===""){sap.m.MessageBox.alert("Confirma a inclusão?",{actions:["Sim","Não"],onClose:function(n){if(n=="Sim"){let n={Usuario:o,Nome:s,ProjetoSegw:r,Email:a};t.create("/AlunosFioriEDSONCRSet",n,{success:function(t,s){let a={type:"Success",title:"Aluno incluido com sucesso !!!",activeTitle:true,description:"O aluno "+o+" foi incluido com sucesso!!!"};i.oData.Menssagens.push(a);i.refresh(true);e.byId("messagePopoverBtn").setType("Accept");l.openBy(e.getView().byId("messagePopoverBtn"));e.CancelarAdicionar()},error:function(t){let s={type:"Error",title:"Erro ao incluir aluno !!!",activeTitle:true,description:"Erro ao incluir aluno "+o+" !!!"};i.oData.Menssagens.push(s);i.refresh(true);e.byId("messagePopoverBtn").setType("Accept");l.openBy(e.getView().byId("messagePopoverBtn"))}})}}})}else{sap.m.MessageBox.error(e.getView().getModel("i18n").getResourceBundle().getText("msgErroAlunoExist"))}},error:function(t){sap.m.MessageBox.error(e.getView().getModel("i18n").getResourceBundle().getText("lblMsgCreateError"))}})},handleMessagePopoverPress:function(){l.openBy(this.getView().byId("messagePopoverBtn"))},onEdit:function(){let e=this.getView().byId("idTable");let t=e.getSelectedItems();if(t.length>0){if(t.length>1){sap.m.MessageBox.error("Só poderá ser editado um registro por vez !!!")}else{let e=t[0].mAggregations.cells[0].getProperty("text");this.getRouter().navTo("RouteDetalhe",{id:e})}}},onChangeArquivo:function(e){let t=e.mParameters.files[0];let i=e.mParameters.files[0].type;let o=this.getView().getModel();let s=this.getView().getModel("Auxiliar");let a=this;if(i!=="text/csv"){MessageBox.error("Seram aceitos apenas arquivos CSV.");return}var r=new FileReader;r.readAsText(t);r.onload=function(){let e=r.result;let t=e.split("\r\n");let i=t.length;let n=t[0].split(";");if(n[0]!=="Usuario"){sap.m.MessageBox.error("A primeira coluna do CSV, deverá ser 'Usuario'.");return}if(n[1]!=="Nome"){sap.m.MessageBox.error("A segunda coluna do CSV, deverá ser 'Nome'.");return}if(n[2]!=="Email"){sap.m.MessageBox.error("A terceira coluna do CSV, deverá ser 'Email'.");return}if(n[3]!=="Projeto SEGW"){sap.m.MessageBox.error("A quarta coluna do CSV, deverá ser 'Projeto SEGW'.");return}for(let e=0;e<i;e++){if(e!==0){let i=t[e].split(";");let r={Usuario:i[0],Nome:i[1],Email:i[2],ProjetoSegw:i[3]};if(r.Usuario!==""){o.create("/AlunosFioriEDSONCRSet",r,{success:function(e,t){let i={type:"Success",title:"Aluno incluido com sucesso !!!",activeTitle:true,description:"O aluno "+r.Usuario+" foi incluido com sucesso!!!"};s.oData.Menssagens.push(i);s.refresh(true);a.byId("messagePopoverBtn").setType("Accept");l.openBy(a.getView().byId("messagePopoverBtn"));a.CancelarAdicionar()},error:function(e){let t={type:"Error",title:"Erro ao incluir aluno !!!",activeTitle:true,description:"Erro ao incluir aluno "+r.Usuario+" !!!"};s.oData.Menssagens.push(t);s.refresh(true);a.byId("messagePopoverBtn").setType("Accept");l.openBy(a.getView().byId("messagePopoverBtn"))}})}}}o.refresh()}}})});
//# sourceMappingURL=View1.controller.js.map